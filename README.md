# Backend Take Home Assignment (MHA)

Submission by: Chai Youxiang </br>
Date: 12 September 2024

## Backend API Implementation using Node.JS and Express.JS

### Tasks

1. Create a backend API with 3 endpoints:

    - GET request - Get an object by ID from a list of JSON object.
    - POST request - Add a new object.
    - DELETE request - Delete an object (should pass in an ID or some identifier).

2. Log all requests to the backend.

3. Validate the add and delete object requests.

4. Create a couple of unit tests cases to test out the endpoints.

5. Implement dependency injection.

**Bonus:** Deploy the above app to the cloud.

## Overview

### Installed dependencies:

<ul>
    <li> Express.JS - For our backend server</li>
    <li> Nodemon - Live reload (installed as DevDependency) </li>
    <li> JOI - HTTP Request Validation for JSON request body </li>
    <li> Pino - Middleware for logging all requests to server </li>
    <li> JEST - Testing </li>
</ul>

### File structure:

```
mha-be-takehome/
├── .git/
├── node_modules/
├── .gitignore
├── app.js              // App's entry-point
├── data.json           // Dummy data to be loaded on server startup
├── package-lock.json
├── package.json
├── README.md
├── schema.js           // Schemas of the data JSON object (used for validation)
└── utils.js            // Utility / helper functions
```

### Data Schema:

| Field         | Constraints                                                                                          |
| ------------- | ---------------------------------------------------------------------------------------------------- |
| uuid          | A unique ID generated by the server using `uuid` module                                              |
| user          | Alphanumeric username string, between 5 to 10 characters long (Required)                             |
| startDateTime | Start date & time of the meditation session                                                          |
| endDateTime   | End date & time for of the meditation session (Must be later than startDateTime, earlier than "now") |

The above schema can be found inside `schema.js` where I have set up JOI to be used for request validation. </br>

## Implementation

When the server first starts up, use `utils.js/fetchDataOnStartup()` to populate the "database" with dummy data.

### 1. Create a backend API using Express.js server with 3 endpoints:

#### 1.1. GET request to fetch an object by ID from JSON object.

The GET endpoint is can be used with or without providing an 'ID' as a query string in the HTTP request. If no ID is provided, then all entries are returned.

#### 1.2. Add new object / entry

To add a new entry, I have created a POST request that validates the request body before appending it to the "database" to ensure that the following are met: </br>

-   <u>user</u> (username) is provided and valid with the above constraints
-   <u>endDateTime</u> is earlier than "now" and is later than <u>startDateTime</u> and both are provided

#### 1.3. Delete an object / entry

To delete an entry, its 'ID' needs to be provided. Validation is done to ensure that the 'ID' is indeed provided and that it is a valid uuid.

### 2. Log all requests to the backend.

This was implemented by using the `pino-http` module as **middleware**. </br>

The following lines of code were added to ensure that all request traffic is logged and formatted for easier reading:

```javascript
const pinoHttp = require("pino-http");
const pino = require("pino");

const logger = pino({
	transport: {
		target: "pino-pretty",
	},
});
const pinoHttpLogger = pinoHttp({ logger });
```

### 3. Validate the add and delete object requests.

See sections [1.2](#1.2.-Add-new-object-/-entry) and [1.3](#1.3.-Delete-an-object-/-entry)
